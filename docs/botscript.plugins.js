!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).BotScriptPlugins=f()}}((function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){module.exports=require("./lib/axios")},{"./lib/axios":3}],2:[function(require,module,exports){"use strict";var utils=require("./../utils"),settle=require("./../core/settle"),cookies=require("./../helpers/cookies"),buildURL=require("./../helpers/buildURL"),buildFullPath=require("../core/buildFullPath"),parseHeaders=require("./../helpers/parseHeaders"),isURLSameOrigin=require("./../helpers/isURLSameOrigin"),createError=require("../core/createError");module.exports=function xhrAdapter(config){return new Promise((function dispatchXhrRequest(resolve,reject){var requestData=config.data,requestHeaders=config.headers;utils.isFormData(requestData)&&delete requestHeaders["Content-Type"];var request=new XMLHttpRequest;if(config.auth){var username=config.auth.username||"",password=config.auth.password?unescape(encodeURIComponent(config.auth.password)):"";requestHeaders.Authorization="Basic "+btoa(username+":"+password)}var fullPath=buildFullPath(config.baseURL,config.url);if(request.open(config.method.toUpperCase(),buildURL(fullPath,config.params,config.paramsSerializer),!0),request.timeout=config.timeout,request.onreadystatechange=function handleLoad(){if(request&&4===request.readyState&&(0!==request.status||request.responseURL&&0===request.responseURL.indexOf("file:"))){var responseHeaders="getAllResponseHeaders"in request?parseHeaders(request.getAllResponseHeaders()):null,response={data:config.responseType&&"text"!==config.responseType?request.response:request.responseText,status:request.status,statusText:request.statusText,headers:responseHeaders,config:config,request:request};settle(resolve,reject,response),request=null}},request.onabort=function handleAbort(){request&&(reject(createError("Request aborted",config,"ECONNABORTED",request)),request=null)},request.onerror=function handleError(){reject(createError("Network Error",config,null,request)),request=null},request.ontimeout=function handleTimeout(){var timeoutErrorMessage="timeout of "+config.timeout+"ms exceeded";config.timeoutErrorMessage&&(timeoutErrorMessage=config.timeoutErrorMessage),reject(createError(timeoutErrorMessage,config,"ECONNABORTED",request)),request=null},utils.isStandardBrowserEnv()){var xsrfValue=(config.withCredentials||isURLSameOrigin(fullPath))&&config.xsrfCookieName?cookies.read(config.xsrfCookieName):void 0;xsrfValue&&(requestHeaders[config.xsrfHeaderName]=xsrfValue)}if("setRequestHeader"in request&&utils.forEach(requestHeaders,(function setRequestHeader(val,key){void 0===requestData&&"content-type"===key.toLowerCase()?delete requestHeaders[key]:request.setRequestHeader(key,val)})),utils.isUndefined(config.withCredentials)||(request.withCredentials=!!config.withCredentials),config.responseType)try{request.responseType=config.responseType}catch(e){if("json"!==config.responseType)throw e}"function"==typeof config.onDownloadProgress&&request.addEventListener("progress",config.onDownloadProgress),"function"==typeof config.onUploadProgress&&request.upload&&request.upload.addEventListener("progress",config.onUploadProgress),config.cancelToken&&config.cancelToken.promise.then((function onCanceled(cancel){request&&(request.abort(),reject(cancel),request=null)})),requestData||(requestData=null),request.send(requestData)}))}},{"../core/buildFullPath":9,"../core/createError":10,"./../core/settle":14,"./../helpers/buildURL":18,"./../helpers/cookies":20,"./../helpers/isURLSameOrigin":23,"./../helpers/parseHeaders":25,"./../utils":27}],3:[function(require,module,exports){"use strict";var utils=require("./utils"),bind=require("./helpers/bind"),Axios=require("./core/Axios"),mergeConfig=require("./core/mergeConfig");function createInstance(defaultConfig){var context=new Axios(defaultConfig),instance=bind(Axios.prototype.request,context);return utils.extend(instance,Axios.prototype,context),utils.extend(instance,context),instance}var axios=createInstance(require("./defaults"));axios.Axios=Axios,axios.create=function create(instanceConfig){return createInstance(mergeConfig(axios.defaults,instanceConfig))},axios.Cancel=require("./cancel/Cancel"),axios.CancelToken=require("./cancel/CancelToken"),axios.isCancel=require("./cancel/isCancel"),axios.all=function all(promises){return Promise.all(promises)},axios.spread=require("./helpers/spread"),axios.isAxiosError=require("./helpers/isAxiosError"),module.exports=axios,module.exports.default=axios},{"./cancel/Cancel":4,"./cancel/CancelToken":5,"./cancel/isCancel":6,"./core/Axios":7,"./core/mergeConfig":13,"./defaults":16,"./helpers/bind":17,"./helpers/isAxiosError":22,"./helpers/spread":26,"./utils":27}],4:[function(require,module,exports){"use strict";function Cancel(message){this.message=message}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,module.exports=Cancel},{}],5:[function(require,module,exports){"use strict";var Cancel=require("./Cancel");function CancelToken(executor){if("function"!=typeof executor)throw new TypeError("executor must be a function.");var resolvePromise;this.promise=new Promise((function promiseExecutor(resolve){resolvePromise=resolve}));var token=this;executor((function cancel(message){token.reason||(token.reason=new Cancel(message),resolvePromise(token.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var cancel;return{token:new CancelToken((function executor(c){cancel=c})),cancel:cancel}},module.exports=CancelToken},{"./Cancel":4}],6:[function(require,module,exports){"use strict";module.exports=function isCancel(value){return!(!value||!value.__CANCEL__)}},{}],7:[function(require,module,exports){"use strict";var utils=require("./../utils"),buildURL=require("../helpers/buildURL"),InterceptorManager=require("./InterceptorManager"),dispatchRequest=require("./dispatchRequest"),mergeConfig=require("./mergeConfig");function Axios(instanceConfig){this.defaults=instanceConfig,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios.prototype.request=function request(config){"string"==typeof config?(config=arguments[1]||{}).url=arguments[0]:config=config||{},(config=mergeConfig(this.defaults,config)).method?config.method=config.method.toLowerCase():this.defaults.method?config.method=this.defaults.method.toLowerCase():config.method="get";var chain=[dispatchRequest,void 0],promise=Promise.resolve(config);for(this.interceptors.request.forEach((function unshiftRequestInterceptors(interceptor){chain.unshift(interceptor.fulfilled,interceptor.rejected)})),this.interceptors.response.forEach((function pushResponseInterceptors(interceptor){chain.push(interceptor.fulfilled,interceptor.rejected)}));chain.length;)promise=promise.then(chain.shift(),chain.shift());return promise},Axios.prototype.getUri=function getUri(config){return config=mergeConfig(this.defaults,config),buildURL(config.url,config.params,config.paramsSerializer).replace(/^\?/,"")},utils.forEach(["delete","get","head","options"],(function forEachMethodNoData(method){Axios.prototype[method]=function(url,config){return this.request(mergeConfig(config||{},{method:method,url:url,data:(config||{}).data}))}})),utils.forEach(["post","put","patch"],(function forEachMethodWithData(method){Axios.prototype[method]=function(url,data,config){return this.request(mergeConfig(config||{},{method:method,url:url,data:data}))}})),module.exports=Axios},{"../helpers/buildURL":18,"./../utils":27,"./InterceptorManager":8,"./dispatchRequest":11,"./mergeConfig":13}],8:[function(require,module,exports){"use strict";var utils=require("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(fulfilled,rejected){return this.handlers.push({fulfilled:fulfilled,rejected:rejected}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(id){this.handlers[id]&&(this.handlers[id]=null)},InterceptorManager.prototype.forEach=function forEach(fn){utils.forEach(this.handlers,(function forEachHandler(h){null!==h&&fn(h)}))},module.exports=InterceptorManager},{"./../utils":27}],9:[function(require,module,exports){"use strict";var isAbsoluteURL=require("../helpers/isAbsoluteURL"),combineURLs=require("../helpers/combineURLs");module.exports=function buildFullPath(baseURL,requestedURL){return baseURL&&!isAbsoluteURL(requestedURL)?combineURLs(baseURL,requestedURL):requestedURL}},{"../helpers/combineURLs":19,"../helpers/isAbsoluteURL":21}],10:[function(require,module,exports){"use strict";var enhanceError=require("./enhanceError");module.exports=function createError(message,config,code,request,response){var error=new Error(message);return enhanceError(error,config,code,request,response)}},{"./enhanceError":12}],11:[function(require,module,exports){"use strict";var utils=require("./../utils"),transformData=require("./transformData"),isCancel=require("../cancel/isCancel"),defaults=require("../defaults");function throwIfCancellationRequested(config){config.cancelToken&&config.cancelToken.throwIfRequested()}module.exports=function dispatchRequest(config){return throwIfCancellationRequested(config),config.headers=config.headers||{},config.data=transformData(config.data,config.headers,config.transformRequest),config.headers=utils.merge(config.headers.common||{},config.headers[config.method]||{},config.headers),utils.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(method){delete config.headers[method]})),(config.adapter||defaults.adapter)(config).then((function onAdapterResolution(response){return throwIfCancellationRequested(config),response.data=transformData(response.data,response.headers,config.transformResponse),response}),(function onAdapterRejection(reason){return isCancel(reason)||(throwIfCancellationRequested(config),reason&&reason.response&&(reason.response.data=transformData(reason.response.data,reason.response.headers,config.transformResponse))),Promise.reject(reason)}))}},{"../cancel/isCancel":6,"../defaults":16,"./../utils":27,"./transformData":15}],12:[function(require,module,exports){"use strict";module.exports=function enhanceError(error,config,code,request,response){return error.config=config,code&&(error.code=code),error.request=request,error.response=response,error.isAxiosError=!0,error.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},error}},{}],13:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function mergeConfig(config1,config2){config2=config2||{};var config={},valueFromConfig2Keys=["url","method","data"],mergeDeepPropertiesKeys=["headers","auth","proxy","params"],defaultToConfig2Keys=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],directMergeKeys=["validateStatus"];function getMergedValue(target,source){return utils.isPlainObject(target)&&utils.isPlainObject(source)?utils.merge(target,source):utils.isPlainObject(source)?utils.merge({},source):utils.isArray(source)?source.slice():source}function mergeDeepProperties(prop){utils.isUndefined(config2[prop])?utils.isUndefined(config1[prop])||(config[prop]=getMergedValue(void 0,config1[prop])):config[prop]=getMergedValue(config1[prop],config2[prop])}utils.forEach(valueFromConfig2Keys,(function valueFromConfig2(prop){utils.isUndefined(config2[prop])||(config[prop]=getMergedValue(void 0,config2[prop]))})),utils.forEach(mergeDeepPropertiesKeys,mergeDeepProperties),utils.forEach(defaultToConfig2Keys,(function defaultToConfig2(prop){utils.isUndefined(config2[prop])?utils.isUndefined(config1[prop])||(config[prop]=getMergedValue(void 0,config1[prop])):config[prop]=getMergedValue(void 0,config2[prop])})),utils.forEach(directMergeKeys,(function merge(prop){prop in config2?config[prop]=getMergedValue(config1[prop],config2[prop]):prop in config1&&(config[prop]=getMergedValue(void 0,config1[prop]))}));var axiosKeys=valueFromConfig2Keys.concat(mergeDeepPropertiesKeys).concat(defaultToConfig2Keys).concat(directMergeKeys),otherKeys=Object.keys(config1).concat(Object.keys(config2)).filter((function filterAxiosKeys(key){return-1===axiosKeys.indexOf(key)}));return utils.forEach(otherKeys,mergeDeepProperties),config}},{"../utils":27}],14:[function(require,module,exports){"use strict";var createError=require("./createError");module.exports=function settle(resolve,reject,response){var validateStatus=response.config.validateStatus;response.status&&validateStatus&&!validateStatus(response.status)?reject(createError("Request failed with status code "+response.status,response.config,null,response.request,response)):resolve(response)}},{"./createError":10}],15:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=function transformData(data,headers,fns){return utils.forEach(fns,(function transform(fn){data=fn(data,headers)})),data}},{"./../utils":27}],16:[function(require,module,exports){(function(process){(function(){"use strict";var utils=require("./utils"),normalizeHeaderName=require("./helpers/normalizeHeaderName"),DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(headers,value){!utils.isUndefined(headers)&&utils.isUndefined(headers["Content-Type"])&&(headers["Content-Type"]=value)}var defaults={adapter:function getDefaultAdapter(){var adapter;return"undefined"!=typeof XMLHttpRequest?adapter=require("./adapters/xhr"):void 0!==process&&"[object process]"===Object.prototype.toString.call(process)&&(adapter=require("./adapters/http")),adapter}(),transformRequest:[function transformRequest(data,headers){return normalizeHeaderName(headers,"Accept"),normalizeHeaderName(headers,"Content-Type"),utils.isFormData(data)||utils.isArrayBuffer(data)||utils.isBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)?data:utils.isArrayBufferView(data)?data.buffer:utils.isURLSearchParams(data)?(setContentTypeIfUnset(headers,"application/x-www-form-urlencoded;charset=utf-8"),data.toString()):utils.isObject(data)?(setContentTypeIfUnset(headers,"application/json;charset=utf-8"),JSON.stringify(data)):data}],transformResponse:[function transformResponse(data){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(status){return status>=200&&status<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],(function forEachMethodNoData(method){defaults.headers[method]={}})),utils.forEach(["post","put","patch"],(function forEachMethodWithData(method){defaults.headers[method]=utils.merge(DEFAULT_CONTENT_TYPE)})),module.exports=defaults}).call(this)}).call(this,require("_process"))},{"./adapters/http":2,"./adapters/xhr":2,"./helpers/normalizeHeaderName":24,"./utils":27,_process:41}],17:[function(require,module,exports){"use strict";module.exports=function bind(fn,thisArg){return function wrap(){for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];return fn.apply(thisArg,args)}}},{}],18:[function(require,module,exports){"use strict";var utils=require("./../utils");function encode(val){return encodeURIComponent(val).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function buildURL(url,params,paramsSerializer){if(!params)return url;var serializedParams;if(paramsSerializer)serializedParams=paramsSerializer(params);else if(utils.isURLSearchParams(params))serializedParams=params.toString();else{var parts=[];utils.forEach(params,(function serialize(val,key){null!=val&&(utils.isArray(val)?key+="[]":val=[val],utils.forEach(val,(function parseValue(v){utils.isDate(v)?v=v.toISOString():utils.isObject(v)&&(v=JSON.stringify(v)),parts.push(encode(key)+"="+encode(v))})))})),serializedParams=parts.join("&")}if(serializedParams){var hashmarkIndex=url.indexOf("#");-1!==hashmarkIndex&&(url=url.slice(0,hashmarkIndex)),url+=(-1===url.indexOf("?")?"?":"&")+serializedParams}return url}},{"./../utils":27}],19:[function(require,module,exports){"use strict";module.exports=function combineURLs(baseURL,relativeURL){return relativeURL?baseURL.replace(/\/+$/,"")+"/"+relativeURL.replace(/^\/+/,""):baseURL}},{}],20:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(name,value,expires,path,domain,secure){var cookie=[];cookie.push(name+"="+encodeURIComponent(value)),utils.isNumber(expires)&&cookie.push("expires="+new Date(expires).toGMTString()),utils.isString(path)&&cookie.push("path="+path),utils.isString(domain)&&cookie.push("domain="+domain),!0===secure&&cookie.push("secure"),document.cookie=cookie.join("; ")},read:function read(name){var match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove:function remove(name){this.write(name,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},{"./../utils":27}],21:[function(require,module,exports){"use strict";module.exports=function isAbsoluteURL(url){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)}},{}],22:[function(require,module,exports){"use strict";module.exports=function isAxiosError(payload){return"object"==typeof payload&&!0===payload.isAxiosError}},{}],23:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){var originURL,msie=/(msie|trident)/i.test(navigator.userAgent),urlParsingNode=document.createElement("a");function resolveURL(url){var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}return originURL=resolveURL(window.location.href),function isURLSameOrigin(requestURL){var parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}}():function isURLSameOrigin(){return!0}},{"./../utils":27}],24:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function normalizeHeaderName(headers,normalizedName){utils.forEach(headers,(function processHeader(value,name){name!==normalizedName&&name.toUpperCase()===normalizedName.toUpperCase()&&(headers[normalizedName]=value,delete headers[name])}))}},{"../utils":27}],25:[function(require,module,exports){"use strict";var utils=require("./../utils"),ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function parseHeaders(headers){var key,val,i,parsed={};return headers?(utils.forEach(headers.split("\n"),(function parser(line){if(i=line.indexOf(":"),key=utils.trim(line.substr(0,i)).toLowerCase(),val=utils.trim(line.substr(i+1)),key){if(parsed[key]&&ignoreDuplicateOf.indexOf(key)>=0)return;parsed[key]="set-cookie"===key?(parsed[key]?parsed[key]:[]).concat([val]):parsed[key]?parsed[key]+", "+val:val}})),parsed):parsed}},{"./../utils":27}],26:[function(require,module,exports){"use strict";module.exports=function spread(callback){return function wrap(arr){return callback.apply(null,arr)}}},{}],27:[function(require,module,exports){"use strict";var bind=require("./helpers/bind"),toString=Object.prototype.toString;function isArray(val){return"[object Array]"===toString.call(val)}function isUndefined(val){return void 0===val}function isObject(val){return null!==val&&"object"==typeof val}function isPlainObject(val){if("[object Object]"!==toString.call(val))return!1;var prototype=Object.getPrototypeOf(val);return null===prototype||prototype===Object.prototype}function isFunction(val){return"[object Function]"===toString.call(val)}function forEach(obj,fn){if(null!=obj)if("object"!=typeof obj&&(obj=[obj]),isArray(obj))for(var i=0,l=obj.length;i<l;i++)fn.call(null,obj[i],i,obj);else for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&fn.call(null,obj[key],key,obj)}module.exports={isArray:isArray,isArrayBuffer:function isArrayBuffer(val){return"[object ArrayBuffer]"===toString.call(val)},isBuffer:function isBuffer(val){return null!==val&&!isUndefined(val)&&null!==val.constructor&&!isUndefined(val.constructor)&&"function"==typeof val.constructor.isBuffer&&val.constructor.isBuffer(val)},isFormData:function isFormData(val){return"undefined"!=typeof FormData&&val instanceof FormData},isArrayBufferView:function isArrayBufferView(val){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(val):val&&val.buffer&&val.buffer instanceof ArrayBuffer},isString:function isString(val){return"string"==typeof val},isNumber:function isNumber(val){return"number"==typeof val},isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:function isDate(val){return"[object Date]"===toString.call(val)},isFile:function isFile(val){return"[object File]"===toString.call(val)},isBlob:function isBlob(val){return"[object Blob]"===toString.call(val)},isFunction:isFunction,isStream:function isStream(val){return isObject(val)&&isFunction(val.pipe)},isURLSearchParams:function isURLSearchParams(val){return"undefined"!=typeof URLSearchParams&&val instanceof URLSearchParams},isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:forEach,merge:function merge(){var result={};function assignValue(val,key){isPlainObject(result[key])&&isPlainObject(val)?result[key]=merge(result[key],val):isPlainObject(val)?result[key]=merge({},val):isArray(val)?result[key]=val.slice():result[key]=val}for(var i=0,l=arguments.length;i<l;i++)forEach(arguments[i],assignValue);return result},extend:function extend(a,b,thisArg){return forEach(b,(function assignValue(val,key){a[key]=thisArg&&"function"==typeof val?bind(val,thisArg):val})),a},trim:function trim(str){return str.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function stripBOM(content){return 65279===content.charCodeAt(0)&&(content=content.slice(1)),content}}},{"./helpers/bind":17}],28:[function(require,module,exports){(function(process){(function(){exports.log=function log(...args){return"object"==typeof console&&console.log&&console.log(...args)},exports.formatArgs=function formatArgs(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,(match=>{"%%"!==match&&(index++,"%c"===match&&(lastC=index))})),args.splice(lastC,0,c)},exports.save=function save(namespaces){try{namespaces?exports.storage.setItem("debug",namespaces):exports.storage.removeItem("debug")}catch(error){}},exports.load=function load(){let r;try{r=exports.storage.getItem("debug")}catch(error){}!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG);return r},exports.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage=function localstorage(){try{return localStorage}catch(error){}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],module.exports=require("./common")(exports);const{formatters:formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}).call(this)}).call(this,require("_process"))},{"./common":29,_process:41}],29:[function(require,module,exports){module.exports=function setup(env){function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}function createDebug(namespace){let prevTime;function debug(...args){if(!debug.enabled)return;const self=debug,curr=Number(new Date),ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,((match,format)=>{if("%%"===match)return match;index++;const formatter=createDebug.formatters[format];if("function"==typeof formatter){const val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match})),createDebug.formatArgs.call(self,args);(self.log||createDebug.log).apply(self,args)}return debug.namespace=namespace,debug.enabled=createDebug.enabled(namespace),debug.useColors=createDebug.useColors(),debug.color=selectColor(namespace),debug.destroy=destroy,debug.extend=extend,"function"==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){const index=createDebug.instances.indexOf(this);return-1!==index&&(createDebug.instances.splice(index,1),!0)}function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(void 0===delimiter?":":delimiter)+namespace);return newDebug.log=this.log,newDebug}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(val){if(val instanceof Error)return val.stack||val.message;return val},createDebug.disable=function disable(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map((namespace=>"-"+namespace))].join(",");return createDebug.enable(""),namespaces},createDebug.enable=function enable(namespaces){let i;createDebug.save(namespaces),createDebug.names=[],createDebug.skips=[];const split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):createDebug.names.push(new RegExp("^"+namespaces+"$")));for(i=0;i<createDebug.instances.length;i++){const instance=createDebug.instances[i];instance.enabled=createDebug.enabled(instance.namespace)}},createDebug.enabled=function enabled(name){if("*"===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1},createDebug.humanize=require("ms"),Object.keys(env).forEach((key=>{createDebug[key]=env[key]})),createDebug.instances=[],createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},{ms:40}],30:[function(require,module,exports){const Evaluator=require("./evaluator/Evaluator"),Lexer=require("./Lexer"),Parser=require("./parser/Parser"),PromiseSync=require("./PromiseSync");module.exports=class Expression{constructor(lang,exprStr){this._lang=lang,this._lexer=new Lexer(lang.grammar),this._exprStr=exprStr,this._ast=null}compile(){const lexer=new Lexer(this._lang.grammar),parser=new Parser(this._lang.grammar),tokens=lexer.tokenize(this._exprStr);return parser.addTokens(tokens),this._ast=parser.complete(),this}eval(context={}){return this._eval(context,Promise)}evalSync(context={}){const res=this._eval(context,PromiseSync);if(res.error)throw res.error;return res.value}_eval(context,promise){return promise.resolve().then((()=>{const ast=this._getAst();return new Evaluator(this._lang.grammar,this._lang.transforms,context,void 0,promise).eval(ast)}))}_getAst(){return this._ast||this.compile(),this._ast}}},{"./Lexer":32,"./PromiseSync":33,"./evaluator/Evaluator":34,"./parser/Parser":37}],31:[function(require,module,exports){const Expression=require("./Expression"),defaultGrammar=require("./grammar").elements;class Jexl{constructor(){this.expr=this.expr.bind(this),this._grammar=Object.assign({},defaultGrammar),this._lexer=null,this._transforms={}}addBinaryOp(operator,precedence,fn){this._addGrammarElement(operator,{type:"binaryOp",precedence:precedence,eval:fn})}addUnaryOp(operator,fn){this._addGrammarElement(operator,{type:"unaryOp",weight:1/0,eval:fn})}addTransform(name,fn){this._transforms[name]=fn}addTransforms(map){for(let key in map)map.hasOwnProperty(key)&&(this._transforms[key]=map[key])}compile(expression){return this.createExpression(expression).compile()}createExpression(expression){const lang=this._getLang();return new Expression(lang,expression)}getTransform(name){return this._transforms[name]}eval(expression,context={}){return this.createExpression(expression).eval(context)}evalSync(expression,context={}){return this.createExpression(expression).evalSync(context)}expr(strs,...args){const exprStr=strs.reduce(((acc,str,idx)=>acc+=str+(idx<args.length?args[idx]:"")),"");return this.createExpression(exprStr)}removeOp(operator){!this._grammar[operator]||"binaryOp"!==this._grammar[operator].type&&"unaryOp"!==this._grammar[operator].type||delete this._grammar[operator]}_addGrammarElement(str,obj){this._grammar[str]=obj}_getLang(){return{grammar:this._grammar,transforms:this._transforms}}}module.exports=new Jexl,module.exports.Jexl=Jexl},{"./Expression":30,"./grammar":36}],32:[function(require,module,exports){const numericRegex=/^-?(?:(?:[0-9]*\.[0-9]+)|[0-9]+)$/,identRegex=/^[a-zA-Z_$][a-zA-Z0-9_$]*$/,escEscRegex=/\\\\/,whitespaceRegex=/^\s*$/,preOpRegexElems=["'(?:(?:\\\\')|[^'])*'",'"(?:(?:\\\\")|[^"])*"',"\\s+","\\btrue\\b","\\bfalse\\b"],postOpRegexElems=["[a-zA-Z_\\$][a-zA-Z0-9_\\$]*","(?:(?:[0-9]*\\.[0-9]+)|[0-9]+)"],minusNegatesAfter=["binaryOp","unaryOp","openParen","openBracket","question","colon"];module.exports=class Lexer{constructor(grammar){this._grammar=grammar}getElements(str){const regex=this._getSplitRegex();return str.split(regex).filter((elem=>elem))}getTokens(elements){const tokens=[];let negate=!1;for(let i=0;i<elements.length;i++)this._isWhitespace(elements[i])?tokens.length&&(tokens[tokens.length-1].raw+=elements[i]):"-"===elements[i]&&this._isNegative(tokens)?negate=!0:(negate&&(elements[i]="-"+elements[i],negate=!1),tokens.push(this._createToken(elements[i])));return negate&&tokens.push(this._createToken("-")),tokens}tokenize(str){const elements=this.getElements(str);return this.getTokens(elements)}_createToken(element){const token={type:"literal",value:element,raw:element};if('"'===element[0]||"'"===element[0])token.value=this._unquote(element);else if(element.match(numericRegex))token.value=parseFloat(element);else if("true"===element||"false"===element)token.value="true"===element;else if(this._grammar[element])token.type=this._grammar[element].type;else{if(!element.match(identRegex))throw new Error(`Invalid expression token: ${element}`);token.type="identifier"}return token}_escapeRegExp(str){return(str=str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).match(identRegex)&&(str="\\b"+str+"\\b"),str}_getSplitRegex(){if(!this._splitRegex){const elemArray=Object.keys(this._grammar).sort(((a,b)=>b.length-a.length)).map((elem=>this._escapeRegExp(elem)),this);this._splitRegex=new RegExp("("+[preOpRegexElems.join("|"),elemArray.join("|"),postOpRegexElems.join("|")].join("|")+")")}return this._splitRegex}_isNegative(tokens){return!tokens.length||minusNegatesAfter.some((type=>type===tokens[tokens.length-1].type))}_isWhitespace(str){return!!str.match(whitespaceRegex)}_unquote(str){const quote=str[0],escQuoteRegex=new RegExp("\\\\"+quote,"g");return str.substr(1,str.length-2).replace(escQuoteRegex,quote).replace(escEscRegex,"\\")}}},{}],33:[function(require,module,exports){class PromiseSync{constructor(fn){fn(this._resolve.bind(this),this._reject.bind(this))}catch(rejected){if(this.error)try{this._resolve(rejected(this.error))}catch(e){this._reject(e)}return this}then(resolved,rejected){if(!this.error)try{this._resolve(resolved(this.value))}catch(e){this._reject(e)}return rejected&&this.catch(rejected),this}_reject(error){this.value=void 0,this.error=error}_resolve(val){val instanceof PromiseSync?val.error?this._reject(val.error):this._resolve(val.value):(this.value=val,this.error=void 0)}}PromiseSync.all=vals=>new PromiseSync((resolve=>{resolve(vals.map((val=>{for(;val instanceof PromiseSync;){if(val.error)throw Error(val.error);val=val.value}return val})))})),PromiseSync.resolve=val=>new PromiseSync((resolve=>resolve(val))),PromiseSync.reject=error=>new PromiseSync(((resolve,reject)=>reject(error))),module.exports=PromiseSync},{}],34:[function(require,module,exports){const handlers=require("./handlers");class Evaluator{constructor(grammar,transforms,context,relativeContext,promise=Promise){this._grammar=grammar,this._transforms=transforms||{},this._context=context||{},this._relContext=relativeContext||this._context,this.Promise=promise}eval(ast){return this.Promise.resolve().then((()=>handlers[ast.type].call(this,ast)))}evalArray(arr){return this.Promise.all(arr.map((elem=>this.eval(elem))))}evalMap(map){const keys=Object.keys(map),result={},asts=keys.map((key=>this.eval(map[key])));return this.Promise.all(asts).then((vals=>(vals.forEach(((val,idx)=>{result[keys[idx]]=val})),result)))}_filterRelative(subject,expr){const promises=[];return Array.isArray(subject)||(subject=void 0===subject?[]:[subject]),subject.forEach((elem=>{const evalInst=new Evaluator(this._grammar,this._transforms,this._context,elem,this.Promise);promises.push(evalInst.eval(expr))})),this.Promise.all(promises).then((values=>{const results=[];return values.forEach(((value,idx)=>{value&&results.push(subject[idx])})),results}))}_filterStatic(subject,expr){return this.eval(expr).then((res=>"boolean"==typeof res?res?subject:void 0:subject[res]))}}module.exports=Evaluator},{"./handlers":35}],35:[function(require,module,exports){exports.ArrayLiteral=function(ast){return this.evalArray(ast.value)},exports.BinaryExpression=function(ast){return this.Promise.all([this.eval(ast.left),this.eval(ast.right)]).then((arr=>this._grammar[ast.operator].eval(arr[0],arr[1])))},exports.ConditionalExpression=function(ast){return this.eval(ast.test).then((res=>res?ast.consequent?this.eval(ast.consequent):res:this.eval(ast.alternate)))},exports.FilterExpression=function(ast){return this.eval(ast.subject).then((subject=>ast.relative?this._filterRelative(subject,ast.expr):this._filterStatic(subject,ast.expr)))},exports.Identifier=function(ast){return ast.from?this.eval(ast.from).then((context=>{if(null!=context)return Array.isArray(context)&&(context=context[0]),context[ast.value]})):ast.relative?this._relContext[ast.value]:this._context[ast.value]},exports.Literal=function(ast){return ast.value},exports.ObjectLiteral=function(ast){return this.evalMap(ast.value)},exports.Transform=function(ast){const transform=this._transforms[ast.name];if(!transform)throw new Error(`Transform ${ast.name} is not defined.`);return this.Promise.all([this.eval(ast.subject),this.evalArray(ast.args||[])]).then((arr=>transform.apply(null,[arr[0]].concat(arr[1]))))},exports.UnaryExpression=function(ast){return this.eval(ast.right).then((right=>this._grammar[ast.operator].eval(right)))}},{}],36:[function(require,module,exports){exports.elements={".":{type:"dot"},"[":{type:"openBracket"},"]":{type:"closeBracket"},"|":{type:"pipe"},"{":{type:"openCurl"},"}":{type:"closeCurl"},":":{type:"colon"},",":{type:"comma"},"(":{type:"openParen"},")":{type:"closeParen"},"?":{type:"question"},"+":{type:"binaryOp",precedence:30,eval:(left,right)=>left+right},"-":{type:"binaryOp",precedence:30,eval:(left,right)=>left-right},"*":{type:"binaryOp",precedence:40,eval:(left,right)=>left*right},"/":{type:"binaryOp",precedence:40,eval:(left,right)=>left/right},"//":{type:"binaryOp",precedence:40,eval:(left,right)=>Math.floor(left/right)},"%":{type:"binaryOp",precedence:50,eval:(left,right)=>left%right},"^":{type:"binaryOp",precedence:50,eval:(left,right)=>Math.pow(left,right)},"==":{type:"binaryOp",precedence:20,eval:(left,right)=>left==right},"!=":{type:"binaryOp",precedence:20,eval:(left,right)=>left!=right},">":{type:"binaryOp",precedence:20,eval:(left,right)=>left>right},">=":{type:"binaryOp",precedence:20,eval:(left,right)=>left>=right},"<":{type:"binaryOp",precedence:20,eval:(left,right)=>left<right},"<=":{type:"binaryOp",precedence:20,eval:(left,right)=>left<=right},"&&":{type:"binaryOp",precedence:10,eval:(left,right)=>left&&right},"||":{type:"binaryOp",precedence:10,eval:(left,right)=>left||right},in:{type:"binaryOp",precedence:20,eval:(left,right)=>"string"==typeof right?-1!==right.indexOf(left):!!Array.isArray(right)&&right.some((elem=>elem===left))},"!":{type:"unaryOp",precedence:1/0,eval:right=>!right}}},{}],37:[function(require,module,exports){const handlers=require("./handlers"),states=require("./states").states;class Parser{constructor(grammar,prefix,stopMap){this._grammar=grammar,this._state="expectOperand",this._tree=null,this._exprStr=prefix||"",this._relative=!1,this._stopMap=stopMap||{}}addToken(token){if("complete"===this._state)throw new Error("Cannot add a new token to a completed Parser");const state=states[this._state],startExpr=this._exprStr;if(this._exprStr+=token.raw,state.subHandler){this._subParser||this._startSubExpression(startExpr);const stopState=this._subParser.addToken(token);if(stopState){if(this._endSubExpression(),this._parentStop)return stopState;this._state=stopState}}else{if(!state.tokenTypes[token.type]){if(this._stopMap[token.type])return this._stopMap[token.type];throw new Error(`Token ${token.raw} (${token.type}) unexpected in expression: ${this._exprStr}`)}{const typeOpts=state.tokenTypes[token.type];let handleFunc=handlers[token.type];typeOpts.handler&&(handleFunc=typeOpts.handler),handleFunc&&handleFunc.call(this,token),typeOpts.toState&&(this._state=typeOpts.toState)}}return!1}addTokens(tokens){tokens.forEach(this.addToken,this)}complete(){if(this._cursor&&!states[this._state].completable)throw new Error(`Unexpected end of expression: ${this._exprStr}`);return this._subParser&&this._endSubExpression(),this._state="complete",this._cursor?this._tree:null}isRelative(){return this._relative}_endSubExpression(){states[this._state].subHandler.call(this,this._subParser.complete()),this._subParser=null}_placeAtCursor(node){this._cursor?(this._cursor.right=node,this._setParent(node,this._cursor)):this._tree=node,this._cursor=node}_placeBeforeCursor(node){this._cursor=this._cursor._parent,this._placeAtCursor(node)}_setParent(node,parent){Object.defineProperty(node,"_parent",{value:parent,writable:!0})}_startSubExpression(exprStr){let endStates=states[this._state].endStates;endStates||(this._parentStop=!0,endStates=this._stopMap),this._subParser=new Parser(this._grammar,exprStr,endStates)}}module.exports=Parser},{"./handlers":38,"./states":39}],38:[function(require,module,exports){exports.argVal=function(ast){this._cursor.args.push(ast)},exports.arrayStart=function(){this._placeAtCursor({type:"ArrayLiteral",value:[]})},exports.arrayVal=function(ast){ast&&this._cursor.value.push(ast)},exports.binaryOp=function(token){const precedence=this._grammar[token.value].precedence||0;let parent=this._cursor._parent;for(;parent&&parent.operator&&this._grammar[parent.operator].precedence>=precedence;)this._cursor=parent,parent=parent._parent;const node={type:"BinaryExpression",operator:token.value,left:this._cursor};this._setParent(this._cursor,node),this._cursor=parent,this._placeAtCursor(node)},exports.dot=function(){this._nextIdentEncapsulate=this._cursor&&"UnaryExpression"!==this._cursor.type&&("BinaryExpression"!==this._cursor.type||"BinaryExpression"===this._cursor.type&&this._cursor.right),this._nextIdentRelative=!this._cursor||this._cursor&&!this._nextIdentEncapsulate,this._nextIdentRelative&&(this._relative=!0)},exports.filter=function(ast){this._placeBeforeCursor({type:"FilterExpression",expr:ast,relative:this._subParser.isRelative(),subject:this._cursor})},exports.identifier=function(token){const node={type:"Identifier",value:token.value};this._nextIdentEncapsulate?(node.from=this._cursor,this._placeBeforeCursor(node),this._nextIdentEncapsulate=!1):(this._nextIdentRelative&&(node.relative=!0,this._nextIdentRelative=!1),this._placeAtCursor(node))},exports.literal=function(token){this._placeAtCursor({type:"Literal",value:token.value})},exports.objKey=function(token){this._curObjKey=token.value},exports.objStart=function(){this._placeAtCursor({type:"ObjectLiteral",value:{}})},exports.objVal=function(ast){this._cursor.value[this._curObjKey]=ast},exports.subExpression=function(ast){this._placeAtCursor(ast)},exports.ternaryEnd=function(ast){this._cursor.alternate=ast},exports.ternaryMid=function(ast){this._cursor.consequent=ast},exports.ternaryStart=function(){this._tree={type:"ConditionalExpression",test:this._tree},this._cursor=this._tree},exports.transform=function(token){this._placeBeforeCursor({type:"Transform",name:token.value,args:[],subject:this._cursor})},exports.unaryOp=function(token){this._placeAtCursor({type:"UnaryExpression",operator:token.value})}},{}],39:[function(require,module,exports){const h=require("./handlers");exports.states={expectOperand:{tokenTypes:{literal:{toState:"expectBinOp"},identifier:{toState:"identifier"},unaryOp:{},openParen:{toState:"subExpression"},openCurl:{toState:"expectObjKey",handler:h.objStart},dot:{toState:"traverse"},openBracket:{toState:"arrayVal",handler:h.arrayStart}}},expectBinOp:{tokenTypes:{binaryOp:{toState:"expectOperand"},pipe:{toState:"expectTransform"},dot:{toState:"traverse"},question:{toState:"ternaryMid",handler:h.ternaryStart}},completable:!0},expectTransform:{tokenTypes:{identifier:{toState:"postTransform",handler:h.transform}}},expectObjKey:{tokenTypes:{identifier:{toState:"expectKeyValSep",handler:h.objKey},closeCurl:{toState:"expectBinOp"}}},expectKeyValSep:{tokenTypes:{colon:{toState:"objVal"}}},postTransform:{tokenTypes:{openParen:{toState:"argVal"},binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},postTransformArgs:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},identifier:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"},question:{toState:"ternaryMid",handler:h.ternaryStart}},completable:!0},traverse:{tokenTypes:{identifier:{toState:"identifier"}}},filter:{subHandler:h.filter,endStates:{closeBracket:"identifier"}},subExpression:{subHandler:h.subExpression,endStates:{closeParen:"expectBinOp"}},argVal:{subHandler:h.argVal,endStates:{comma:"argVal",closeParen:"postTransformArgs"}},objVal:{subHandler:h.objVal,endStates:{comma:"expectObjKey",closeCurl:"expectBinOp"}},arrayVal:{subHandler:h.arrayVal,endStates:{comma:"arrayVal",closeBracket:"expectBinOp"}},ternaryMid:{subHandler:h.ternaryMid,endStates:{colon:"ternaryEnd"}},ternaryEnd:{subHandler:h.ternaryEnd,completable:!0}}},{"./handlers":38}],40:[function(require,module,exports){var s=1e3,m=60*s,h=60*m,d=24*h,w=7*d,y=365.25*d;function plural(ms,msAbs,n,name){var isPlural=msAbs>=1.5*n;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"===type&&val.length>0)return function parse(str){if((str=String(str)).length>100)return;var match=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"weeks":case"week":case"w":return n*w;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(val);if("number"===type&&!1===isNaN(val))return options.long?function fmtLong(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return plural(ms,msAbs,d,"day");if(msAbs>=h)return plural(ms,msAbs,h,"hour");if(msAbs>=m)return plural(ms,msAbs,m,"minute");if(msAbs>=s)return plural(ms,msAbs,s,"second");return ms+" ms"}(val):function fmtShort(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return Math.round(ms/d)+"d";if(msAbs>=h)return Math.round(ms/h)+"h";if(msAbs>=m)return Math.round(ms/m)+"m";if(msAbs>=s)return Math.round(ms/s)+"s";return ms+"ms"}(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],41:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],42:[function(require,module,exports){module.exports={name:"@yeuai/botscript",version:"1.4.0",description:"A text-based scripting language and bot engine for Conversational User Interfaces (CUI)",main:"dist/engine",scripts:{test:"mocha",build:"rimraf dist && tsc","build:web":"npx gulp"},repository:{type:"git",url:"git+https://github.com/yeuai/botscript.git"},keywords:["chatbot","dialog","engine"],author:"vunb",license:"MIT",bugs:{url:"https://github.com/yeuai/botscript/issues"},homepage:"https://github.com/yeuai/botscript#readme",devDependencies:{"@types/chai":"^4.2.12","@types/debug":"^4.1.5","@types/jexl":"^2.2.0","@types/mocha":"^5.2.7","@types/node":"^12.12.57","@types/xregexp":"^4.3.0","axios-mock-adapter":"^1.19.0",browserify:"^17.0.0",chai:"^4.2.0",gulp:"^4.0.2","gulp-cli":"^2.3.0","gulp-sourcemaps":"^3.0.0","gulp-terser":"^2.0.1","gulp-typescript":"^6.0.0-alpha.1",mocha:"^6.2.3",rimraf:"^3.0.2","ts-node-dev":"^1.0.0-pre.62",tsify:"^5.0.2",tslint:"^5.20.1",typescript:"^3.9.7","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},dependencies:{axios:"^0.21.1",debug:"^4.1.1",jexl:"^2.2.2",xregexp:"^4.3.0",xstate:"^4.13.0"},files:["dist","src","LICENSE","README.md"],publishConfig:{access:"public"}}},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var request_1=require("./engine/request");Object.defineProperty(exports,"Request",{enumerable:!0,get:function(){return request_1.Request}});var context_1=require("./engine/context");Object.defineProperty(exports,"Context",{enumerable:!0,get:function(){return context_1.Context}});var struct_1=require("./engine/struct");Object.defineProperty(exports,"Struct",{enumerable:!0,get:function(){return struct_1.Struct}})},{"./engine/context":44,"./engine/request":45,"./engine/struct":46}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Context=void 0;const utils_1=require("../lib/utils");exports.Context=class Context{constructor(){this.definitions=new Map,this.dialogues=new Map,this.flows=new Map,this.commands=new Map,this.patterns=new Map,this.plugins=new Map,this.directives=new Map}get id(){return this.definitions.has("botid")?this.definitions.get("botid").value:""}getDialogue(name){return this.flows.has(name)?this.flows.get(name):this.dialogues.get(name)}interpolateDefinition(text){return text.replace(/\[([\w-]+)\]/g,((match,defName)=>{const list=this.definitions.get(defName.toLowerCase());return list?utils_1.random(list.options):defName}))}interpolateVariables(text,req){return text.replace(/\$([a-z][\w_-]*)(\.[.\w[\]]*[\w\]])/g,((match,variable,output)=>{const result=req.variables[variable];return result&&result[output]||""})).replace(/[#$]\{?([a-z][\w_-]*)\}?/g,((match,variable)=>req.variables[variable]||"")).replace(/(\$\d*(?![\w\d]))/g,((match,variable)=>req.variables[variable]||""))}interpolate(text,req){let output=this.interpolateDefinition(text);return output=this.interpolateVariables(output,req),output}}},{"../lib/utils":49}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Request=void 0;exports.Request=class Request{constructor(message){this.flows=[],this.variables={},this.isFlowing=!1,this.resolvedFlows=[],this.missingFlows=[],this.previous=[],message&&(this.message=message.toLowerCase())}enter(text){return this.message=text,this}}},{}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Struct=exports.TYPES=void 0,exports.TYPES={"!":"definition","+":"dialogue","-":"response","@":"command","?":"question","~":"flows","#":"comment","*":"condition",">":"plugin","/":"directive"};class Struct{constructor(content){this.type=function getScriptType(script){return exports.TYPES[script.charAt(0)]}(content),this.head=function getScriptHead(script){const type=script.charAt(0);return script.split("\n").map((x=>x.trim())).filter((x=>x.startsWith(type))).map((x=>x.substring(1).trim()))}(content),this.body=function getScriptBody(script){const type=script.charAt(0);return script.split("\n").map((x=>x.trim())).filter((x=>!x.startsWith(type)))}(content),this.content=content,this.name=this.head.find((()=>!0))||"",this.flows=[],this.replies=[],this.triggers=[],this.conditions=[],this.options=[]}static parse(data){const struct=new Struct(data);switch(struct.type){case exports.TYPES["!"]:if(0===struct.body.length){const tokens=struct.head[0].split(" ");struct.value=tokens.pop()||"",struct.name=tokens.pop()||"",struct.options=[struct.value]}else struct.options=struct.body.map((x=>x.replace(/^-\s*/,""))),struct.options.length>1?struct.value=struct.options:struct.value=struct.options.find((x=>!0));break;case exports.TYPES["+"]:struct.triggers=struct.head,struct.replies=struct.body.filter((x=>x.startsWith("-"))).map((x=>x.replace(/^-\s*/,""))),struct.flows=struct.body.filter((x=>x.startsWith("~"))).map((x=>x.replace(/^~\s*/,""))),struct.conditions=struct.body.filter((x=>x.startsWith("*"))).map((x=>x.replace(/^\*\s*/,"")));break;case exports.TYPES["~"]:struct.triggers=struct.body.filter((x=>x.startsWith("+"))).map((x=>x.replace(/^\+\s*/,""))),struct.replies=struct.body.filter((x=>x.startsWith("-"))).map((x=>x.replace(/^-\s*/,""))),struct.flows=struct.body.filter((x=>x.startsWith("~"))).map((x=>x.replace(/^~\s*/,""))),struct.conditions=struct.body.filter((x=>x.startsWith("*"))).map((x=>x.replace(/^\*\s*/,"")));break;case exports.TYPES["@"]:const tokens=struct.head[0].split(" ");if(2===tokens.length)struct.name=tokens[0],struct.options=["GET",tokens[1]];else{if(3!==tokens.length)throw new Error("invalid command");{const action=/post/i.test(tokens[1])?"post":"get";struct.name=tokens[0],struct.options=[action,tokens[2]]}}break;case exports.TYPES[">"]:struct.conditions=struct.body.filter((x=>x.startsWith("*"))).map((x=>x.replace(/^\*\s*/,"")));break;case exports.TYPES["/"]:if(0===struct.body.length){const sepIndex=struct.head[0].indexOf(":");struct.name=struct.head[0].substr(0,sepIndex).trim(),struct.value=struct.head[0].substr(sepIndex+1).trim(),struct.options=[struct.value]}else struct.options=struct.body.map((x=>x.replace(/^-\s*/,""))),struct.options.length>1?struct.value=struct.options:struct.value=struct.options.find((x=>!0))}return struct}toString(){return`${this.type}: ${this.options.join(",")}`}}exports.Struct=Struct},{}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Types=void 0,function(Types){Types.Definition="!",Types.Trigger="+",Types.Reply="-",Types.Flow="~",Types.Condition="*",Types.Comment="#",Types.ConditionalFlow="~",Types.ConditionalReply="-",Types.ConditionalCommand="@",Types.ConditionalPrompt="?",Types.ConditionalForward=">",Types.ConditionalEvent="+"}(exports.Types||(exports.Types={}))},{}],48:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;const debug_1=__importDefault(require("debug"));exports.Logger=class Logger{constructor(prefix){prefix=prefix?":"+prefix:"",this._debug=debug_1.default(`BotScript:DEBUG${prefix}`),this._info=debug_1.default(`BotScript:INFO${prefix}`),this._warn=debug_1.default(`BotScript:WARN${prefix}`),this._error=debug_1.default(`BotScript:ERROR${prefix}`)}get debug(){return this._debug}get info(){return this._info}get warn(){return this._warn}get error(){return this._error}}},{debug:28}],49:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.downloadScripts=exports.callHttpService=exports.evaluate=exports.testConditionalType=exports.testConditionalReply=exports.testConditionalFlow=exports.random=void 0;const axios_1=__importDefault(require("axios")),jexl_1=require("jexl"),types_1=require("../interfaces/types"),logger=new(require("./logger").Logger)("Utils");function testConditionalType(type,dialogue,req,callback){if(!dialogue)return logger.info("No dialogue for test:",type),!1;const separator=new RegExp(`\\${type}>`);return(dialogue.conditions||[]).filter((x=>separator.test(x))).some((cond=>{const tokens=cond.split(separator).map((x=>x.trim()));if(2===tokens.length){const expr=tokens[0],value=tokens[1];if(logger.debug(`Test conditional type: ${type}, botid=${req.botId}, expr=${expr}`),evaluate(expr,req.variables))return callback(value,req)}}))}function evaluate(code,context){const keys=Object.keys(context||{}),vars=Object.assign({},...keys.map((x=>({[x.startsWith("$")?x:`$${x}`]:context[x]}))));try{return logger.debug("Evaluate:",code),jexl_1.evalSync(code,vars)}catch(err){return void logger.warn("Error while eval expression",{msg:err&&err.message})}}exports.random=function random(candidates){return candidates[Math.floor(Math.random()*candidates.length)]},exports.testConditionalFlow=function testConditionalFlow(dialogue,req,callback){return testConditionalType(types_1.Types.ConditionalFlow,dialogue,req,callback)},exports.testConditionalReply=function testConditionalReply(dialogue,req,callback){return testConditionalType(types_1.Types.ConditionalReply,dialogue,req,callback)},exports.testConditionalType=testConditionalType,exports.evaluate=evaluate,exports.callHttpService=function callHttpService(command,req){const vIsGetMethod=/^get$/i.test(command.options[0]),headers=command.body.map((x=>x.split(":"))),method=vIsGetMethod?"GET":"POST",url=command.options[1],body=vIsGetMethod?void 0:req.variables;return logger.info("Send request:",method,url,body),axios_1.default.request({url:url,headers:headers,method:method,data:body}).then((res=>res.data)).catch((err=>(logger.error("Can not send request:",url,method,body,headers,err),Promise.reject(err))))},exports.downloadScripts=function downloadScripts(url){return __awaiter(this,void 0,void 0,(function*(){logger.info("Starting download",url);const vResult=yield axios_1.default.get(url),vContentType=vResult.headers["content-type"];if(/^text\/plain/.test(vContentType)){return[yield vResult.data]}if(/^application\/json/.test(vContentType)){return yield vResult.data}throw new Error("Data format unsupported!")}))}},{"../interfaces/types":47,"./logger":48,axios:1,jexl:31}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addTimeNow=void 0,exports.addTimeNow=function addTimeNow(req,ctx){const now=new Date;req.variables.time=`${now.getHours()}:${now.getMinutes()}`}},{}],51:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./addTimeNow"),exports),__exportStar(require("./noReplyHandle"),exports),__exportStar(require("./normalize"),exports),__exportStar(require("./nlu"),exports),__exportStar(require("../version"),exports)},{"../version":56,"./addTimeNow":50,"./nlu":52,"./noReplyHandle":53,"./normalize":54}],52:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.nlu=void 0;const common_1=require("../common"),utils_1=require("../lib/utils"),logger=new(require("../lib/logger").Logger)("NLU"),defaultCommandNlu=common_1.Struct.parse("@ nlu https://botscript.ai/api/nlu"),defaultDirectiveNlu=common_1.Struct.parse("/nlu: nlu");exports.nlu=function nlu(req,ctx){return __awaiter(this,void 0,void 0,(function*(){const vDirectiveNlu=ctx.directives.get("nlu")||defaultDirectiveNlu,vCommandNlu=ctx.commands.get(vDirectiveNlu.value)||defaultCommandNlu;logger.info(`Send nlu request: (${vDirectiveNlu.value})`,req.message);try{const{intent:intent="__UNKNOW__",entities:entities=[]}=yield utils_1.callHttpService(vCommandNlu,req);req.intent=intent,req.entities=entities}catch(error){logger.error("Cannot extract nlu message!",error)}}))}},{"../common":43,"../lib/logger":48,"../lib/utils":49}],53:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.noReplyHandle=void 0;const utils=__importStar(require("../lib/utils"));exports.noReplyHandle=function noReplyHandle(){return(res,ctx)=>{if("NO REPLY!"===res.speechResponse)if(ctx.flows.has(res.currentFlow)){const dialog=ctx.flows.get(res.currentFlow),replyCandidate=utils.random(dialog.replies);res.speechResponse=replyCandidate}else res.speechResponse="Sorry! I don't understand!"}}},{"../lib/utils":49}],54:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalize=void 0;const clean_1=__importDefault(require("./utils/clean"));exports.normalize=function normalize(req){req.message=clean_1.default.all(req.message).replace(/[+-?!.,]+$/,"")}},{"./utils/clean":55}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const re1=new RegExp(/\+/g),re2=new RegExp(/\t/g),re3=new RegExp(/\s+/g),re4=new RegExp(/(|)/g),re5=new RegExp(/(|)/g),re6=new RegExp(/(|)/g),re7=new RegExp(/[\u00A1-\u1EF3]/g),re8=new RegExp(/[+]{1}/g),re9=new RegExp(/<plus>/g),re10=new RegExp(/\d,\d/g);function pre(msg=""){return msg=(msg=(msg=(msg=(msg=(msg=(msg=msg.replace(re1,"<plus>")).replace(re2," ")).replace(re3," ")).replace(re4,"'")).replace(re5,'"')).replace(re6,"")).replace(re7," ")}function post(msg=""){return msg=(msg=(msg=msg.replace(re8," ")).replace(re9,"+")).replace(re10,(v=>v.replace(",","")))}exports.default={pre:pre,post:post,all:function all(msg=""){return post(pre(msg)).trim()}}},{}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0;const{version:version}=require("../package.json");exports.version=version},{"../package.json":42}]},{},[51])(51)}));
//# sourceMappingURL=botscript.plugins.js.map
